<%# include("../partials/header.ejs")%>

  <h1><%= title %></h1>
  <% if (locals.message) { %>
    <div class="flash-message"><%= message %></div>
  <% } %>

  <div><%- detail %></div>

  <!-- REVIEWS SECTION -->
<section class="reviews-section">
  <h2>Reviews</h2>
  
  <!-- Display existing reviews -->
  <% if (reviews && reviews.length > 0) { %>
    <div class="reviews-list">
      <% reviews.forEach(review => { %>
        <div class="review-item">
          <p class="review-text"><%= review.review_text %></p>
          <p class="review-meta">
            By <%= review.account_firstname.charAt(0) %><%= review.account_lastname %> 
            on <%= new Date(review.review_date).toLocaleDateString() %>
          </p>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <p>No reviews yet. Be the first to review!</p>
  <% } %>
  
  <!-- Add review form or login prompt -->
  <% if (locals.loggedin) { %>
    <h3>Write a Review</h3>
    <form action="/review/add" method="post" class="review-form">
      <label for="review_text">Your Review:</label>
      <textarea id="review_text" name="review_text" rows="5" required 
                placeholder="Share your thoughts about this vehicle..."></textarea>
      
      <p class="screen-name">
        Posting as: <%= accountData.account_firstname.charAt(0) %><%= accountData.account_lastname %>
      </p>
      
      <input type="hidden" name="inv_id" value="<%= inv_id %>">
      <input type="hidden" name="account_id" value="<%= accountData.account_id %>">
      
      <button type="submit">Submit Review</button>
    </form>
  <% } else { %>
    <p><a href="/account/login">Log in</a> to write a review.</p>
  <% } %>
</section>

<%#  include("../partials/footer.ejs") %>